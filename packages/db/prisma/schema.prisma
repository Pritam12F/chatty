generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String      @id @unique @default(uuid())
  name        String?
  email       String
  accountType AccountType
  password    String?
  isTrial     Boolean     @default(true)
  hasPaid     Boolean     @default(false) // set to false when user reaches a limit
  rooms       Room[]
}

model Room {
  id              String    @id @unique @default(uuid())
  name            String
  video           Video?
  transcribedText String
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  summary         String?
  activity        Activity[]
  chapters        Chapter[]
  chats           Chat[]
  cards           Card[]
}

model Video {
  id          String   @id @unique @default(cuid())
  videoId     String
  title       String
  description String?
  thumbnail   String?
  duration    DateTime
  url         String
  roomId      String   @unique
  room        Room     @relation(fields: [roomId], references: [id])
}

model Activity {
  id         String @id @unique @default(cuid())
  type       ActivityType
  roomId     String 
  room       Room   @relation(fields: [roomId], references: [id])
}

model Card {
  id      String @id @unique @default(uuid())
  content String
  color   String
  roomId  String
  room    Room   @relation(fields: [roomId], references: [id])
}

model Chapter {
  id        String   @id @unique @default(uuid())
  title     String
  content   String
  startTime DateTime
  endTime   DateTime
  roomId    String
  room      Room     @relation(fields: [roomId], references: [id])
}

model Chat {
  id        String     @id @unique @default(uuid())
  title     String
  prompt    String
  prompType PromptType
  roomId    String
  room      Room       @relation(fields: [roomId], references: [id])
}

enum AccountType {
  CREDENTIALS
  GOOGLE
  GITHUB
}

enum PromptType {
  USER
  SYSTEM
} 

enum ActivityType {
  GEN_SUMMARY
  GEN_CARDS
  GEN_CHAPTERS
  START_CHAT
}
